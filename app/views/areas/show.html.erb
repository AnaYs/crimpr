<div class="container-fluid">

  <div class="row">

    <div class="col-xs-12 col-md-8 pull-left">
      <h1><%= @area.name %></h1>

      <div class="row real-time">
        <ul class = "list-inline">
          <li><%= @temperature %></li>
          <li><%= @pressure %></li>
          <li><%= @condition %></li>
          <li><%= @sunrise %> </li>
          <li><%= @sunset %></li>
          <li><%= @icon %></li>
        </ul>
      </div>

      <div class="row description">
        <p><%= @area.description %></p>
      </div>


      <h2>Sectors</h2>
      <div id="list">
        <ul>
          <% @area.sectors.each do |sector|%>
            <li><%= link_to sector.name, area_sector_path(@area, sector) %></li>
          <% end %>
        </ul>
        <%= link_to new_area_sector_path(@area), class:"btn btn-default" do %>
          <i class="fa fa-plus"> Add a sector for <%= @area.name %> </i>
        <% end %>
      </div>
    </div>

    <div class="col-xs-12 col-md-4 pull-right">
      <div id="geolocation" style="width: 100%; height: 400px;"></div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
    <h2>Pictures</h2>
    <i class="fa fa-plus"></i>
          <% @area.pictures.sample(4) do |pic| %>
            <div class="col-xs-12 col-sm-3 pictures">
              <%= image_tag pic.picture.url %>
            </div>
          <% end %>
<!-- add this to a modal/ pop-up window on clicking plus symbol next to heading -->
          <%= form_for [@area, @area.pictures.new] do |f| %>
          <p>
           <%= f.label :picture %>
           <%= f.file_field :picture %>
          </p>
          <p> <%= f.submit %> </p>
          <% end %>
    </div>
  </div>

<br>

  <%= link_to "Home", areas_path, class:"btn btn-default" %>

<% content_for(:before_js) do %>
  <%= javascript_tag do %>
    var markers = <%= raw @markers.to_json %>;
    var lat = <%= @area.latitude %>;
    var lng = <%= @area.longitude %>;
    var image_icon = "<%= image_url "climber_icon.png" %>";
  <% end %>
<% end %>


<% content_for(:after_js) do %>
<%= javascript_tag do %>
      $(document).on('ready', function() {
        var mapOptions = { mapTypeId: google.maps.MapTypeId.SATELLITE };
        var handler = Gmaps.build('Google');

        var myPositionMarker = {
            lat: lat,
            lng: lng,
            infowindow: 'Your location',
            picture: {
              url: image_icon,
              width: 36,
              height: 36
            }
          };

          <!-- markers.push(myPositionMarker); -->

        handler.buildMap({
          provider: mapOptions,
          internal: {id: 'geolocation'}}, function() {
          var markersHandled = handler.addMarker(myPositionMarker);
<!-- does not display any map nor error in Console -->
<!-- if I write addMarkers get error Uncaught RangeError: Maximum call stack size exceeded -->

        handler.bounds.extendWith(markersHandled);
        handler.fitMapToBounds();
        });
      });
    <% end %>
  <% end %>


</div>


